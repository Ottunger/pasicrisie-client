<ion-header>
    <ion-navbar>
        <ion-title>{{tour.humanId}}: {{tour.prototypeRouteName}}</ion-title>
    </ion-navbar>
</ion-header>

<ion-content>
    <table class="table-map">
        <tr>
            <td style="width: 50%;">
                <ion-card>
                    <ion-card-content>
                        <table style="table-layout: fixed;">
                            <thead>
                                <tr><th style="width: 6%;"><th style="width: 60%;"></th><th style="width: 17%;"></th><th style="width: 17%;"></th></tr>
                                <tr><th colspan="4">{{'tours.from' | translate}}: {{api.addressToString(tour.tourStops[0].stop)}}
                                    <span style="color: green;"> {{'tours.at' | translate}} {{tour.driverArrival | date:'HH:mm'}}</span></th></tr>
                                <tr><th colspan="4">{{'tours.to' | translate}}: {{api.addressToString(tour.tourStops[tour.tourStops.length - 1].stop)}}
                                    <span style="color: red;"> {{'tours.at' | translate}} {{tour.tourStops[tour.tourStops.length - 1].arrival | date:'HH:mm'}}</span></th></tr>
                                <tr><th colspan="4">{{'tour.numPassengers' | translate}}: {{tour.rides.length}}</th></tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let ts of tour.tourStops; let f = first; let i = index">
                                    <td align="left">{{(i + 1)}}</td>
                                    <td align="left">{{api.addressToString(ts.stop)}}</td>
                                    <td>{{ts.arrival | date:'HH:mm'}}</td>
                                    <td align="right"><span *ngIf="!f">[{{ts.timeFromPreviousStop | date:'mm:ss'}}]</span></td>
                                </tr>
                            </tbody>
                        </table>

                        <button *ngIf="tour.state === tourStates.FINALIZED" [style.background-color]="diffPositive? (diffInMs > 5*60*1000? 'red' : 'green') : 'blue'"
                                class="start-button" ion-button block large (click)="next()" [disabled]="notFirstNotDone()">
                            {{'tours.goMep' | translate}}
                        </button>
                        <button *ngIf="tour.state === tourStates.TO_MEP" [style.background-color]="diffPositive? (diffInMs > 5*60*1000? 'red' : 'green') : 'blue'"
                                class="start-button" ion-button block large (click)="next()" [disabled]="notFirstNotDone()">
                            {{'tours.startMep' | translate}}
                        </button>
                        <button *ngIf="tour.state === tourStates.AT_MEP" [style.background-color]="diffPositive? (diffInMs > 5*60*1000? 'red' : 'green') : 'blue'"
                                class="start-button" ion-button block large (click)="accept()" [disabled]="notFirstNotDone()">
                            {{'tours.endMep' | translate}} [{{diffInMs | date:'HH:mm:ss':'+0'}}]
                        </button>

                        <hr *ngIf="!tour.isMorning"/>
                        <p *ngIf="!tour.isMorning">{{'tour.noMorning' | translate}}</p>
                        <!--
                        <hr/>
                        <p>{{'tour.legatory' | translate}}</p>
                        -->
                    </ion-card-content>
                </ion-card>
            </td>
            <td style="width: 50%;">
                <div [id]="mapId" class="map" data-tap-disabled="true"></div>
            </td>
        </tr>
    </table>
</ion-content>
